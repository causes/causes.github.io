
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Overcommit: The opinionated Git hook manager &middot; Causes Engineering</title>

<meta name="author" content="Causes Engineers">

<meta name="description" content="At Causes, we care deeply about code quality. We
promote thorough, offline code review through
Gerrit and take pride in each commit we
make. Due to &hellip;"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Causes Engineering" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>



<body>
	<header id="header" class="inner"><h1><a href="/">Causes Engineering</a></h1>
<h4></h4>
<nav id="main-nav"><ul>
	<li><a href="/">Words</a></li>
	<li><a href="https://github.com/causes">Code</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/">Words</a></li>
	<li><a href="https://github.com/causes">Code</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:causes.github.io">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner"><article class="post">
	<h2 class="title">Overcommit: The Opinionated Git Hook Manager</h2>
	<div class="entry-content"><p>At <a href="http://www.causes.com">Causes</a>, we care deeply about code quality.  We
promote thorough, offline code review through
<a href="https://code.google.com/p/gerrit/">Gerrit</a> and take pride in each commit we
make. Due to the sheer volume of code review and the number of engineers on our
team, it&rsquo;s important that by the time other engineers review our code we have an
established baseline of quality.</p>

<p>There are a few important ingredients to making a good commit:</p>

<ul>
<li>Correctness: The code does what you expect it to do</li>
<li>Commit message: Tim Pope provides an excellent summary of <a href="http://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html">what makes a good
commit message</a></li>
<li>Style: The code matches our team&rsquo;s coding styles</li>
<li>Test coverage: relevant tests have been run, and any new features have spec
coverage</li>
</ul>


<p>Enter <a href="https://github.com/causes/overcommit">overcommit</a>. This evolved from a
single file linter into a full-fledged, extensible hook architecture.  Available
as a Ruby gem:</p>

<pre><code>gem install overcommit
</code></pre>

<p>What does it do? In short, it automates away all the tedium before a commit
reaches code review. It ships with a set of opinionated lints that ensure a
level of consistency and quality in our commits.</p>

<h2>In Action</h2>

<p>Here&rsquo;s an example of overcommit saving me from committing janky code:</p>

<pre><code>❯❯❯ echo "eval('alert(\"hello world\")');" > eval.js
❯❯❯ git add eval.js
❯❯❯ git commit
Running pre_commit checks
  Checking causes_email...........<span class="success">OK</span>
  Checking test_history...........<span class="warning">No relevant tests for this change...write some?</span>
  Checking restricted_paths.......<span class="success">OK</span>
  Checking js_console_log.........<span class="success">OK</span>
  Checking js_syntax..............<span class="error">FAILED</span>
    eval.js: line 1, col 1, eval can be harmful.

    1 error
  Checking author_name............<span class="success">OK</span>
  Checking whitespace.............<span class="success">OK</span>

<span class="error">!!! One or more pre_commit checks failed</span>
</code></pre>




<!-- more -->


<h2>Installation</h2>

<p>After installing the gem, a new binary, <code>overcommit</code>, will be available. You can
use this binary to install git hooks into an existing repository like so:</p>

<pre><code>overcommit my-project
</code></pre>

<p>Where <code>my-project</code> is the directory of a git repository. In addition to
installing hooks into <code>my-project/.git/hooks</code>, this will also write an
<code>overcommit.yml</code> file containing repository-specific configuration. You can use
this, for example, to always skip a certain type of lint. See more options by
running <code>overcommit --help</code>.</p>

<h2>Built-in functionality</h2>

<h4>pre-commit hooks</h4>

<ul>
<li><p><code>coffee_lint</code> uses <a href="http://www.coffeelint.org/">CoffeeLint</a> to keep your
CoffeeScript clean and consistent.</p></li>
<li><p><code>haml_syntax</code> verifies that any <a href="http://haml.info/">Haml</a> file to be committed
is syntactially valid.</p></li>
<li><p><code>js_syntax</code> uses <a href="http://www.jshint.com/">jshint</a> to ensure best JavaScript
practices are followed.</p></li>
<li><p><code>python_flake8</code> uses <a href="https://pypi.python.org/pypi/flake8">flake8</a> to lint
Python code.</p></li>
<li><p><code>ruby_syntax</code> makes sure that any Ruby files to be committed are syntactically
valid by  running <code>ruby -c #{staged_file}</code>.</p></li>
<li><p><code>scss_lint</code> integrates with our <a href="github.com/causes/scss-lint">scss-lint</a> gem
to ensure our stylesheets are the best they can be. This includes alphabetizing
properties, removing unnecessary units, and so much more. <a href="https://github.com/causes/scss-lint#what-gets-linted">Read
more</a> about what gets
linted.</p></li>
<li><p><code>whitespace</code> verifies that no hard tabs are used and that no trailing
whitespace is included. The devil is in the details.</p></li>
</ul>


<p>There are more hooks included, including Causes-specific ones (such as making
sure your @causes.com email address is used), but these are excluded by
default. See the rest of the lints
<a href="https://github.com/causes/overcommit/tree/master/lib/overcommit/plugins/pre_commit">here</a>.</p>

<h4>commit-msg hooks</h4>

<ul>
<li><p><code>russian_novel</code> is just for fun, to reward developers for writing exemplary
(long) commit messages.</p></li>
<li><p><code>text_width</code> ensures that the body of the commit is hard-wrapped to 72
characters, and that the subject is &lt;= 60 characters.</p></li>
<li><p><code>trailing_period</code> warns the author if their commit message subject ends with a period.</p></li>
</ul>


<h2>Extensibility</h2>

<p>In addition to the gem-provided, global hooks, <code>overcommit</code> also allows for
repository-specific hooks to be added. An example from the documentation is our
<a href="http://www.opscode.com/chef/">Chef</a> repository-specific hook to run
<a href="http://acrmp.github.io/foodcritic/">Foodcritic</a> against any cookbooks being
committed.</p>

<p>This file lives in kitchen.git/.githooks/pre_commit/food_critic.rb</p>

<figure class='code'><figcaption><span>food_critic.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Overcommit::GitHook</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">FoodCritic</span> <span class="o">&lt;</span> <span class="no">HookSpecificCheck</span>
</span><span class='line'>    <span class="kp">include</span> <span class="no">HookRegistry</span>
</span><span class='line'>    <span class="no">COOKBOOKS</span> <span class="o">=</span> <span class="s1">&#39;cookbooks&#39;</span>
</span><span class='line'>    <span class="vc">@@options</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:tags</span> <span class="o">=&gt;</span> <span class="sx">%w[~readme ~fc001]</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">run_check</span>
</span><span class='line'>      <span class="k">begin</span>
</span><span class='line'>        <span class="nb">require</span> <span class="s1">&#39;foodcritic&#39;</span>
</span><span class='line'>      <span class="k">rescue</span> <span class="no">LoadError</span>
</span><span class='line'>        <span class="k">return</span> <span class="ss">:stop</span><span class="p">,</span> <span class="s1">&#39;run `bundle install` to install the foodcritic gem&#39;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">changed_cookbooks</span> <span class="o">=</span> <span class="n">modified_files</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
</span><span class='line'>        <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">1</span><span class="o">].</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">start_with?</span> <span class="no">COOKBOOKS</span>
</span><span class='line'>      <span class="k">end</span><span class="o">.</span><span class="n">compact</span><span class="o">.</span><span class="n">uniq</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">linter</span> <span class="o">=</span> <span class="o">::</span><span class="ss">FoodCritic</span><span class="p">:</span><span class="ss">:Linter</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>      <span class="n">review</span> <span class="o">=</span> <span class="n">linter</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">changed_cookbooks</span><span class="p">,</span> <span class="vc">@@options</span><span class="p">)</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">(</span><span class="n">review</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">any?</span> <span class="p">?</span> <span class="ss">:bad</span> <span class="p">:</span> <span class="ss">:good</span><span class="p">),</span> <span class="n">review</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Skipping checks</h2>

<p>There are, of course, times when you&rsquo;re going to need to break the rules. You
can skip any lint by passing the underscore-ized name into the <code>SKIP_CHECKS</code>
environment variable. This can either be a single lint, or a
comma/colon-separated list of lints to skip:</p>

<pre><code>SKIP_CHECKS=js_syntax:restricted_paths git commit
</code></pre>

<p>There&rsquo;s also the special value of <code>all</code>, which will skip all of the non-required
lints.</p>

<h2>The future</h2>

<p>Until recently, overcommit has only been useful inside Causes due to the
specific lints we run and the lack of easy installation. We hope others find it
useful, and have released it under the MIT license. Pull requests are welcome.
<a href="https://github.com/causes/overcommit">View the source on GitHub</a>.</p>

<p>Happy hacking.</p>
</div>


<div class="meta">
	
	<div class="author">Aiden Scandella</div>
	
	<div class="date">








  


<time datetime="2013-05-30T14:02:00-07:00" pubdate data-updated="true">May 30<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/automation/'>Automation</a>, <a class='category' href='/blog/categories/git/'>Git</a>


</div>
	
</div>
</article>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2014

    Causes Engineers

<br>
Powered by Octopress.
</footer>
	<script src="/javascripts/slash.js"></script>

	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-31836-33']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




</body>
</html>
